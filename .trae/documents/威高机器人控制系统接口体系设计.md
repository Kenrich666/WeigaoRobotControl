# 威高机器人控制系统接口体系设计方案

## 一、整体架构设计

### 1.1 分层架构

```
┌─────────────────────────────────────────┐
│         UI层 (Presentation Layer)        │
│  - Activity/Fragment                    │
│  - ViewModel                            │
│  - LiveData/StateFlow                   │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      应用层接口 (Application Layer)      │
│  - IDeliveryService (配送服务)          │
│  - IPointService (点位服务)              │
│  - IDoorService (舱门服务)               │
│  - IRemoteService (远程服务)             │
│  - IAudioService (音频服务)              │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      架构层接口 (Architecture Layer)      │
│  - IRobotDevice (设备抽象)               │
│  - IMotorController (电机控制)           │
│  - ICommunication (通信管理)             │
│  - IDataProcessor (数据处理)             │
│  - IStateManager (状态管理)              │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│      SDK层 (Peanut SDK Wrapper)          │
│  - PeanutSDK                             │
└─────────────────────────────────────────┘
```

## 二、文件结构规划

### 2.1 架构层文件（开发人员A）

```
app/src/main/java/com/weigao/robot/control/
├── core/
│   ├── device/
│   │   ├── IRobotDevice.java              # 设备抽象接口
│   │   ├── RobotDeviceImpl.java           # 设备实现
│   │   ├── IMotorController.java          # 电机控制接口
│   │   ├── MotorControllerImpl.java       # 电机控制实现
│   │   └── package-info.java
│   ├── communication/
│   │   ├── ICommunication.java            # 通信管理接口
│   │   ├── CommunicationManager.java     # 通信管理实现
│   │   ├── RequestHandler.java            # 请求处理器
│   │   └── package-info.java
│   ├── data/
│   │   ├── IDataProcessor.java            # 数据处理接口
│   │   ├── DataProcessorImpl.java         # 数据处理实现
│   │   ├── ResponseParser.java            # 响应解析器
│   │   └── package-info.java
│   └── state/
│       ├── IStateManager.java             # 状态管理接口
│       ├── StateManagerImpl.java          # 状态管理实现
│       ├── RobotState.java                # 机器人状态
│       └── package-info.java
└── model/
    ├── DeviceInfo.java                    # 设备信息模型
    ├── MotorInfo.java                     # 电机信息模型
    ├── PointInfo.java                     # 点位信息模型
    ├── DeliveryTask.java                  # 配送任务模型
    └── package-info.java
```

### 2.2 应用层文件（开发人员B）

```
app/src/main/java/com/weigao/robot/control/
├── service/
│   ├── IDeliveryService.java              # 配送服务接口
│   ├── DeliveryServiceImpl.java           # 配送服务实现
│   ├── IPointService.java                 # 点位服务接口
│   ├── PointServiceImpl.java              # 点位服务实现
│   ├── IDoorService.java                  # 舱门服务接口
│   ├── DoorServiceImpl.java               # 舱门服务实现
│   ├── IRemoteService.java                # 远程服务接口
│   ├── RemoteServiceImpl.java             # 远程服务实现
│   ├── IAudioService.java                 # 音频服务接口
│   ├── AudioServiceImpl.java              # 音频服务实现
│   └── package-info.java
├── ui/
│   ├── main/
│   │   ├── MainActivity.java              # 主界面
│   │   ├── MainViewModel.java             # 主视图模型
│   │   └── package-info.java
│   ├── delivery/
│   │   ├── DeliveryActivity.java          # 配送界面
│   │   ├── DeliveryViewModel.java         # 配送视图模型
│   │   └── package-info.java
│   ├── point/
│   │   ├── PointManagementActivity.java   # 点位管理界面
│   │   ├── PointManagementViewModel.java  # 点位管理视图模型
│   │   └── package-info.java
│   └── settings/
│       ├── SettingsActivity.java          # 设置界面
│       ├── SettingsViewModel.java         # 设置视图模型
│       └── package-info.java
└── utils/
    ├── CallbackHelper.java                # 回调辅助工具
    ├── ErrorHandler.java                   # 错误处理器
    └── package-info.java
```

## 三、核心接口定义

### 3.1 架构层接口（开发人员A）

#### IRobotDevice.java

* 获取设备列表

* 获取设备版本信息

* 获取设备配置

* 更新设备配置

* 重启设备

* 获取急停按钮状态

#### IMotorController.java

* 获取电机状态

* 获取电机健康状态

* 控制电机启停

* 设置电机速度

#### ICommunication.java

* 初始化通信连接

* 发送请求

* 接收响应

* 处理错误

* 断开连接

#### IDataProcessor.java

* 解析JSON响应

* 验证数据格式

* 转换数据模型

* 序列化请求数据

#### IStateManager.java

* 获取机器人状态

* 更新机器人状态

* 监听状态变化

* 状态持久化

### 3.2 应用层接口（开发人员B）

#### IDeliveryService.java

* 标准配送：startStandardDelivery()

* 循环配送：startLoopDelivery()

* 物品回收：startRecoveryDelivery()

* 慢速配送：startSlowDelivery()

* 暂停配送：pauseDelivery()

* 恢复配送：resumeDelivery()

* 取消配送：cancelDelivery()

* 获取配送状态：getDeliveryStatus()

#### IPointService.java

* 获取所有点位：getAllPoints()

* 获取最近使用点位：getRecentPoints()

* 添加点位：addPoint()

* 删除点位：deletePoint()

* 更新点位：updatePoint()

* 设置返回点：setReturnPoint()

* 设置待机点：setStandbyPoint()

#### IDoorService.java

* 打开舱门：openDoor()

* 关闭舱门：closeDoor()

* 验证密码：verifyPassword()

* 设置脚踩灯光开关门：setFootSwitchEnabled()

* 设置到达后自动离开：setAutoLeaveEnabled()

#### IRemoteService.java

* 启用远程呼叫：enableRemoteCall()

* 呼叫循环：callLoop()

* 呼叫到达：callArrival()

* 设置到达后停留时长：setStayDuration()

#### IAudioService.java

* 设置配送背景音乐：setDeliveryMusic()

* 设置语音音量：setVoiceVolume()

* 设置配送音量：setDeliveryVolume()

* 设置语音播报频率：setAnnouncementFrequency()

## 四、数据模型定义

### 4.1 核心数据模型

* DeviceInfo：设备信息

* MotorInfo：电机信息

* PointInfo：点位信息

* DeliveryTask：配送任务

* DeliveryConfig：配送配置

* AudioConfig：音频配置

* RobotState：机器人状态

## 五、回调与错误处理

### 5.1 统一回调接口

* IResultCallback<T>：通用结果回调

* IProgressCallback：进度回调

* IStateCallback：状态变化回调

### 5.2 错误处理

* ErrorCode：错误码定义

* ErrorType：错误类型

* ErrorHandler：错误处理器

## 六、接口文档内容

### 6.1 每个接口包含

* 接口说明

* 方法签名

* 参数说明

* 返回值说明

* 调用示例

* 异常处理

* 前置条件

* 注意事项

### 6.2 交互流程图

* 标准配送流程

* 循环配送流程

* 远程呼叫流程

* 舱门控制流程

## 七、协作规范

### 7.1 接口变更管理

* 版本号规则

* 变更日志

* 兼容性说明

### 7.2 测试标准

* 单元测试规范

* 集成测试规范

* 接口测试用例

### 7.3 交付物清单

1. 接口设计文档（Markdown格式）
2. 接口调用示例代码
3. 测试用例
4. 版本说明文档

## 实施步骤

1. 创建架构层接口定义文件
2. 创建应用层接口定义文件
3. 创建数据模型文件
4. 创建回调与错误处理文件
5. 编写接口文档
6. 编写调用示例代码
7. 编写测试用例
8. 创建版本说明文档


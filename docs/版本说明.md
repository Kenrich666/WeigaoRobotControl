# 威高机器人控制系统接口体系版本说明

## 文档版本信息

| 版本号 | 日期 | 作者 | 变更说明 |
|--------|------|------|----------|
| v1.0.0 | 2026-01-18 | System | 初始版本 |

## 版本历史

### v1.0.0 (2026-01-18)

#### 新增功能

**架构层接口（开发人员A）**
- IRobotDevice：设备管理接口
  - getDeviceList：获取设备列表
  - getBoardInfo：获取主板信息
  - getConfig：获取设备配置
  - updateConfig：更新设备配置
  - reboot：重启设备
  - getScramButtonStatus：获取急停按钮状态
  - openFan/closeFan：控制W3机器舱内风扇

- IMotorController：电机控制接口
  - getStatus：获取电机状态
  - getHealth：获取电机健康状态
  - enableMotor：控制电机启停
  - setSpeed：设置电机速度
  - stopMotor：停止电机

- ICommunication：通信管理接口
  - initialize：初始化通信连接
  - sendRequest：发送请求
  - disconnect：断开连接
  - isConnected：检查连接状态
  - setConnectionTimeout/getConnectionTimeout：设置/获取连接超时

- IDataProcessor：数据处理接口
  - parseResponse：解析JSON响应
  - serializeRequest：序列化请求数据
  - validateData：验证数据格式
  - parseDeviceInfo/parseMotorInfo/parsePointInfo：解析特定类型数据

- IStateManager：状态管理接口
  - getCurrentState：获取当前状态
  - updateState：更新状态
  - registerStateListener/unregisterStateListener：注册/注销状态监听器
  - clearStateListeners：清除所有监听器
  - saveState/loadState：保存/加载状态

**应用层接口（开发人员B）**
- IDeliveryService：配送服务接口
  - startStandardDelivery：启动标准配送
  - startLoopDelivery：启动循环配送
  - startRecoveryDelivery：启动物品回收配送
  - startSlowDelivery：启动慢速配送
  - pauseDelivery：暂停配送
  - resumeDelivery：恢复配送
  - cancelDelivery：取消配送
  - getDeliveryStatus：获取配送状态
  - updateDeliveryConfig/getDeliveryConfig：更新/获取配送配置

- IPointService：点位服务接口
  - getAllPoints：获取所有点位
  - getRecentPoints：获取最近使用点位
  - getPointsByFloor：获取指定楼层点位
  - addPoint：添加点位
  - deletePoint：删除点位
  - updatePoint：更新点位
  - setReturnPoint/getReturnPoint：设置/获取返回点
  - setStandbyPoint/getStandbyPoint：设置/获取待机点

- IDoorService：舱门服务接口
  - openDoor/closeDoor：打开/关闭舱门
  - verifyPassword：验证密码
  - setFootSwitchEnabled：设置脚踩灯光开关门
  - setAutoLeaveEnabled：设置到达后自动离开
  - getDoorStatus/getAllDoorsStatus：获取舱门状态

- IRemoteService：远程服务接口
  - enableRemoteCall/isRemoteCallEnabled：启用/检查远程呼叫
  - callLoop：呼叫循环
  - callArrival：呼叫到达
  - callRecovery：呼叫回收
  - setStayDuration/getStayDuration：设置/获取停留时长

- IAudioService：音频服务接口
  - setDeliveryMusic/setLoopMusic：设置配送/循环配送背景音乐
  - setVoiceVolume/getVoiceVolume：设置/获取语音音量
  - setDeliveryVolume/getDeliveryVolume：设置/获取配送音量
  - setAnnouncementFrequency：设置语音播报频率
  - getAudioConfig/updateAudioConfig：获取/更新音频配置

**数据模型**
- DeviceInfo：设备信息模型
- MotorInfo：电机信息模型
- PointInfo：点位信息模型
- DeliveryTask：配送任务模型
- DeliveryConfig：配送配置模型
- AudioConfig：音频配置模型
- RobotState：机器人状态模型

**回调与错误处理**
- IResultCallback<T>：通用结果回调接口
- IProgressCallback<T>：进度回调接口
- IStateCallback：状态变化回调接口
- ApiError：API错误类
- ErrorCode：错误码常量定义
- ErrorHandler：错误处理工具类
- CallbackHelper：回调辅助工具类

**文档与示例**
- 接口设计文档：包含完整的接口定义、数据结构、交互流程
- 接口调用示例代码：提供各种场景的调用示例
- 测试用例：包含86个测试用例，覆盖所有接口和功能

#### 设计原则

1. **高内聚低耦合**：明确划分架构层与应用层边界，各层职责清晰
2. **易用性**：提供简洁易用的高层API，隐藏底层复杂性
3. **一致性**：统一接口命名规范、参数格式和返回值结构
4. **可扩展性**：预留扩展点，支持功能增强和版本升级
5. **完善的错误处理**：提供统一的错误码和错误处理机制

#### 架构分层

```
UI层 (Presentation Layer)
    ↓
应用层接口 (Application Layer)
    ↓
架构层接口 (Architecture Layer)
    ↓
SDK层 (Peanut SDK Wrapper)
```

#### 协作规范

1. **接口变更管理**
   - 版本号规则：MAJOR.MINOR.PATCH
   - 变更日志：记录所有接口变更
   - 兼容性说明：保持向后兼容

2. **接口测试标准**
   - 单元测试规范：测试覆盖率不低于80%
   - 集成测试规范：测试接口协作
   - 接口测试用例：包含正常、边界、异常场景

3. **接口版本控制策略**
   - 版本管理：使用Git进行版本控制
   - 平滑升级：提供迁移指南和兼容性适配层
   - 向后兼容：新增接口不影响现有接口

#### 文件结构

```
app/src/main/java/com/weigao/robot/control/
├── core/                              # 架构层
│   ├── device/
│   │   ├── IRobotDevice.java
│   │   ├── IMotorController.java
│   │   └── package-info.java
│   ├── communication/
│   │   ├── ICommunication.java
│   │   └── package-info.java
│   ├── data/
│   │   ├── IDataProcessor.java
│   │   └── package-info.java
│   ├── state/
│   │   ├── IStateManager.java
│   │   └── package-info.java
│   └── package-info.java
├── service/                           # 应用层
│   ├── IDeliveryService.java
│   ├── IPointService.java
│   ├── IDoorService.java
│   ├── IRemoteService.java
│   ├── IAudioService.java
│   └── package-info.java
├── model/                             # 数据模型
│   ├── DeviceInfo.java
│   ├── MotorInfo.java
│   ├── PointInfo.java
│   ├── DeliveryTask.java
│   ├── DeliveryConfig.java
│   ├── AudioConfig.java
│   ├── RobotState.java
│   └── package-info.java
├── callback/                          # 回调与错误处理
│   ├── IResultCallback.java
│   ├── IProgressCallback.java
│   ├── IStateCallback.java
│   ├── ApiError.java
│   ├── ErrorCode.java
│   └── package-info.java
├── utils/                             # 工具类
│   ├── CallbackHelper.java
│   ├── ErrorHandler.java
│   └── package-info.java
└── example/                           # 示例代码
    └── InterfaceUsageExample.java
```

#### 交付物清单

1. ✅ 接口设计文档（含接口定义、数据结构、交互流程）
2. ✅ 接口调用示例代码
3. ✅ 测试用例（86个测试用例）
4. ✅ 版本说明文档

## 未来计划

### v1.1.0（计划中）

#### 预期新增功能

- 增加更多配送模式支持
- 增加路径规划接口
- 增加地图管理接口
- 增加日志记录接口
- 增加性能监控接口

#### 预期优化

- 优化接口响应时间
- 优化错误处理机制
- 优化状态管理性能
- 增加接口缓存机制

### v1.2.0（计划中）

#### 预期新增功能

- 增加多机器人协同接口
- 增加任务调度接口
- 增加数据分析接口
- 增加远程监控接口
- 增加OTA升级接口

## 已知问题

当前版本无已知问题。

## 兼容性说明

### SDK版本

- 最低支持版本：Peanut SDK V1.3.4
- 推荐版本：Peanut SDK V1.3.4

### Android版本

- 最低支持版本：Android 5.0 (API 21)
- 推荐版本：Android 10.0 (API 29) 或更高

### Java版本

- 最低支持版本：Java 1.8
- 推荐版本：Java 1.8

## 升级指南

### 从旧版本升级

当前版本为初始版本，暂无旧版本升级指南。

### 向新版本升级

当新版本发布时，请参考以下步骤：

1. 阅读新版本的变更日志
2. 检查是否有破坏性变更
3. 更新接口实现代码
4. 更新依赖库版本
5. 执行回归测试
6. 部署到测试环境验证
7. 部署到生产环境

## 反馈与支持

### 问题反馈

如果您在使用过程中遇到问题或有任何建议，请通过以下方式反馈：

- 提交Issue：[待补充]
- 发送邮件：[待补充]
- 联系技术支持：[待补充]

### 技术支持

- 技术支持热线：[待补充]
- 技术支持邮箱：[待补充]
- 在线文档：[待补充]

## 附录

### A. 术语表

| 术语 | 说明 |
|------|------|
| SDK | Software Development Kit，软件开发工具包 |
| API | Application Programming Interface，应用程序编程接口 |
| 回调 | 异步操作完成后调用的函数 |
| 点位 | 机器人的物理位置 |
| 配送 | 机器人运送物品的过程 |
| 循环配送 | 机器人在多个点位间往复移动 |
| 回收配送 | 从多个点位收集物品并运回回收点 |
| 慢速配送 | 以低速平稳的方式运送精密或易碎物品 |
| 急停按钮 | 紧急停止机器人运动的按钮 |
| 舱门 | 机器人用于存放物品的舱室门 |
| 远程呼叫 | 通过远程方式呼叫机器人到指定点位 |

### B. 参考文档

- Peanut SDK V1.3.4开发文档
- 威高机器人控制系统功能需求书
- 接口设计文档
- 测试用例文档

### C. 联系方式

- 项目负责人：[待补充]
- 技术负责人：[待补充]
- 测试负责人：[待补充]

---

**文档结束**

# å¨é«˜æœºå™¨äººæ§åˆ¶ç³»ç»Ÿå¼€å‘æŒ‡å¯¼æ‰‹å†Œ

> **ç‰ˆæœ¬**: 3.0  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-18  
> **é€‚ç”¨å¯¹è±¡**: Dev Aï¼ˆæ¶æ„ä¸ç¡¬ä»¶åº•å±‚ï¼‰ã€Dev Bï¼ˆä¸šåŠ¡æµç¨‹ä¸UIäº¤äº’ï¼‰

---

## ä¸€ã€é¡¹ç›®æ¶æ„

### 1.1 åˆ†å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        UI Layer (Dev B)                          â”‚
â”‚              ui/ (Activity/Fragment/ViewModel)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Manager Layer (Dev B)                        â”‚
â”‚              manager/ (ä¸šåŠ¡çŠ¶æ€æœºã€æµç¨‹ç¼–æ’)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Service Interface Layer                       â”‚
â”‚                 service/ (8ä¸ªI*Serviceæ¥å£)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Callback Interface Layer                       â”‚
â”‚                 callback/ (6ä¸ªå›è°ƒæ¥å£+é”™è¯¯ç )                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Service Implementation (Dev A)                  â”‚
â”‚                      service/impl/                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Core Layer (Dev A)                          â”‚
â”‚      core/ (communication/ | device/ | data/ | state/)          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Peanut SDK (AAR)                            â”‚
â”‚        PeanutNavigation â”‚ PeanutCharger â”‚ PeanutDoor            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ç›®å½•ç»“æ„

```
com.weigao.robot.control/
â”‚
â”œâ”€â”€ app/                          # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ WeigaoApplication.java    # SDKåˆå§‹åŒ–
â”‚
â”œâ”€â”€ base/                         # åŸºç¡€ç±» (Dev B)
â”‚   â””â”€â”€ (å¾…å®ç°)
â”‚
â”œâ”€â”€ callback/                     # å›è°ƒæ¥å£å±‚ âœ… å·²å®Œæˆ
â”‚   â”œâ”€â”€ IResultCallback.java      # é€šç”¨ç»“æœå›è°ƒ
â”‚   â”œâ”€â”€ IProgressCallback.java    # è¿›åº¦å›è°ƒ
â”‚   â”œâ”€â”€ IStateCallback.java       # æœºå™¨äººçŠ¶æ€å›è°ƒ
â”‚   â”œâ”€â”€ INavigationCallback.java  # å¯¼èˆªå›è°ƒ
â”‚   â”œâ”€â”€ IDoorCallback.java        # èˆ±é—¨å›è°ƒ
â”‚   â”œâ”€â”€ IChargerCallback.java     # å……ç”µå›è°ƒ
â”‚   â”œâ”€â”€ ApiError.java             # é”™è¯¯å¯¹è±¡
â”‚   â”œâ”€â”€ ErrorCode.java            # åº”ç”¨å±‚é”™è¯¯ç ï¼ˆä¸­æ–‡ï¼‰
â”‚   â””â”€â”€ SdkErrorCode.java         # SDKé”™è¯¯ç ï¼ˆå¯¹é½Peanut SDKï¼‰
â”‚
â”œâ”€â”€ model/                        # æ•°æ®æ¨¡å‹å±‚ âœ… å·²å®Œæˆï¼ˆ13ä¸ªç±»ï¼‰
â”‚   â”œâ”€â”€ DeliveryTask.java         # é…é€ä»»åŠ¡ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ DeliveryConfig.java       # é…é€é…ç½®ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ LoopDeliveryConfig.java   # å¾ªç¯é…é€é…ç½®ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ PointInfo.java            # ç‚¹ä½ä¿¡æ¯ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ NavigationNode.java       # å¯¼èˆªèŠ‚ç‚¹ï¼ˆSerializableï¼‰âœ… å·²ä¿®å¤
â”‚   â”œâ”€â”€ NavigationState.java      # å¯¼èˆªçŠ¶æ€å¸¸é‡ âœ… å«å·¥å…·æ–¹æ³•
â”‚   â”œâ”€â”€ ChargerInfo.java          # å……ç”µä¿¡æ¯ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ DoorType.java             # èˆ±é—¨ç±»å‹æšä¸¾
â”‚   â”œâ”€â”€ RobotState.java           # æœºå™¨äººçŠ¶æ€ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ AudioConfig.java          # éŸ³é¢‘é…ç½®ï¼ˆSerializableï¼‰
â”‚   â”œâ”€â”€ TaskTiming.java           # è®¡æ—¶ä¿¡æ¯ï¼ˆçº¯æ•°æ®æ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ DeviceInfo.java           # è®¾å¤‡ä¿¡æ¯ï¼ˆSerializableï¼‰âœ… å·²ä¿®å¤
â”‚   â””â”€â”€ MotorInfo.java            # ç”µæœºä¿¡æ¯ï¼ˆSerializableï¼‰âœ… å·²ä¿®å¤
â”‚
â”œâ”€â”€ service/                      # æœåŠ¡æ¥å£å±‚ âœ… å·²å®Œæˆï¼ˆ8ä¸ªæ¥å£ï¼‰
â”‚   â”œâ”€â”€ INavigationService.java   # å¯¼èˆªæœåŠ¡ï¼ˆå«cancelArrivalControlï¼‰
â”‚   â”œâ”€â”€ IDoorService.java         # èˆ±é—¨æœåŠ¡
â”‚   â”œâ”€â”€ IChargerService.java      # å……ç”µæœåŠ¡ï¼ˆå«releaseæ–¹æ³•ï¼‰
â”‚   â”œâ”€â”€ ISecurityService.java     # å®‰å…¨é”å®šæœåŠ¡
â”‚   â”œâ”€â”€ ITimingService.java       # è®¡æ—¶æœåŠ¡
â”‚   â”œâ”€â”€ IAudioService.java        # éŸ³é¢‘æœåŠ¡
â”‚   â”œâ”€â”€ IRobotStateService.java   # æœºå™¨äººçŠ¶æ€æœåŠ¡ï¼ˆå«è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢ï¼‰
â”‚   â”œâ”€â”€ IRemoteCallService.java   # è¿œç¨‹å‘¼å«æœåŠ¡ âœ… æ–°å¢
â”‚   â””â”€â”€ impl/                     # å®ç°ç±»ç›®å½• (Dev Aå¾…å®ç°)
â”‚
â”œâ”€â”€ core/                         # æ ¸å¿ƒåº•å±‚ (Dev A)
â”‚   â”œâ”€â”€ communication/            # é€šä¿¡å±‚
â”‚   â”‚   â””â”€â”€ ICommunication.java
â”‚   â”œâ”€â”€ device/                   # è®¾å¤‡æ§åˆ¶
â”‚   â”‚   â”œâ”€â”€ IRobotDevice.java
â”‚   â”‚   â””â”€â”€ IMotorController.java
â”‚   â”œâ”€â”€ data/                     # æ•°æ®å¤„ç†
â”‚   â”‚   â””â”€â”€ IDataProcessor.java
â”‚   â””â”€â”€ state/                    # çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ IStateManager.java
â”‚       â””â”€â”€ TimingController.java # è®¡æ—¶æ§åˆ¶å™¨ âœ… æ–°å¢
â”‚
â”œâ”€â”€ manager/                      # ä¸šåŠ¡é€»è¾‘å±‚ (Dev Bå¾…å®ç°)
â”‚   â””â”€â”€ (å¾…å®ç°)
â”‚
â”œâ”€â”€ data/                         # æ•°æ®å­˜å‚¨å±‚ (å¾…å®ç°)
â”‚   â”œâ”€â”€ db/                       # æœ¬åœ°æ•°æ®åº“
â”‚   â””â”€â”€ api/                      # åå°API
â”‚
â”œâ”€â”€ ui/                           # ç•Œé¢å±‚ (Dev B)
â”‚   â”œâ”€â”€ main/                     # ä¸»ç•Œé¢
â”‚   â”œâ”€â”€ task/                     # ä»»åŠ¡ç•Œé¢ (å¾…å®ç°)
â”‚   â”œâ”€â”€ auth/                     # è®¤è¯ç•Œé¢ (å¾…å®ç°)
â”‚   â””â”€â”€ settings/                 # è®¾ç½®ç•Œé¢ (å¾…å®ç°)
â”‚
â””â”€â”€ utils/                        # å·¥å…·ç±»
    â”œâ”€â”€ CallbackHelper.java
    â””â”€â”€ ErrorHandler.java
```

---

## äºŒã€æœåŠ¡æ¥å£è¯¦ç»†è¯´æ˜

### 2.1 INavigationService - å¯¼èˆªæœåŠ¡

**æ–‡ä»¶**: `service/INavigationService.java`  
**å¯¹åº”éœ€æ±‚**: ç¬¬3ç«  æ ¸å¿ƒé…é€æ¨¡å¼ã€ç¬¬4ç«  è·¯å¾„ä¸ç‚¹ä½ç®¡ç†

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `ROUTE_POLICY_ADAPTIVE` | 0 | è‡ªé€‚åº”è·¯çº¿ç­–ç•¥ |
| `ROUTE_POLICY_FIXED` | 1 | å›ºå®šè·¯çº¿ç­–ç•¥ |
| `DIRECTION_FORWARD` | 0 | æ‰‹åŠ¨æ§åˆ¶ï¼šå‰è¿› |
| `DIRECTION_BACKWARD` | 1 | æ‰‹åŠ¨æ§åˆ¶ï¼šåé€€ |
| `DIRECTION_LEFT` | 2 | æ‰‹åŠ¨æ§åˆ¶ï¼šå·¦è½¬ |
| `DIRECTION_RIGHT` | 3 | æ‰‹åŠ¨æ§åˆ¶ï¼šå³è½¬ |

**æ ¸å¿ƒæ–¹æ³•**:
```java
// è®¾ç½®å¯¼èˆªç›®æ ‡ç‚¹
void setTargets(List<NavigationNode> targets, IResultCallback<Void> callback);

// å‡†å¤‡å¯¼èˆª
void prepare(IResultCallback<Void> callback);

// å¼€å§‹å¯¼èˆª
void start(IResultCallback<Void> callback);

// æš‚åœ/åœæ­¢
void pause(IResultCallback<Void> callback);
void stop(IResultCallback<Void> callback);

// è·³è½¬åˆ°æŒ‡å®šèŠ‚ç‚¹
void skipTo(int nodeIndex, IResultCallback<Void> callback);

// å–æ¶ˆå½“å‰ç‚¹ä½çš„è¿‘ä¼¼åˆ°è¾¾æ§åˆ¶ âœ… å¯¹é½SDK
void cancelArrivalControl(IResultCallback<Void> callback);

// æ‰‹åŠ¨æ§åˆ¶
void manualControl(int direction, boolean enable, IResultCallback<Void> callback);

// å›è°ƒæ³¨å†Œ
void registerCallback(INavigationCallback callback);
void unregisterCallback(INavigationCallback callback);
```

### 2.2 IChargerService - å……ç”µæœåŠ¡

**æ–‡ä»¶**: `service/IChargerService.java`  
**å¯¹åº”éœ€æ±‚**: å……ç”µæ§åˆ¶

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `CHARGE_ACTION_AUTO` | 0 | è‡ªåŠ¨å……ç”µ |
| `CHARGE_ACTION_MANUAL` | 1 | æ‰‹åŠ¨å……ç”µ |
| `CHARGE_ACTION_ADAPTER` | 2 | é€‚é…å……ç”µ |
| `CHARGE_ACTION_STOP` | 3 | åœæ­¢å……ç”µ |

**æ ¸å¿ƒæ–¹æ³•**:
```java
// å……ç”µæ“ä½œ
void startAutoCharge(IResultCallback<Void> callback);
void startManualCharge(IResultCallback<Void> callback);
void stopCharge(IResultCallback<Void> callback);
void performAction(int action, IResultCallback<Void> callback);

// å……ç”µæ¡©è®¾ç½®
void setChargePileId(int pileId, IResultCallback<Void> callback);
void getChargePileId(IResultCallback<Integer> callback);

// çŠ¶æ€æŸ¥è¯¢
void getChargerInfo(IResultCallback<ChargerInfo> callback);
void getBatteryLevel(IResultCallback<Integer> callback);
void isCharging(IResultCallback<Boolean> callback);

// é‡Šæ”¾èµ„æº âœ… å¯¹é½SDK
void release();

// å›è°ƒæ³¨å†Œ
void registerCallback(IChargerCallback callback);
void unregisterCallback(IChargerCallback callback);
```

### 2.3 IRemoteCallService - è¿œç¨‹å‘¼å«æœåŠ¡ âœ… æ–°å¢

**æ–‡ä»¶**: `service/IRemoteCallService.java`  
**å¯¹åº”éœ€æ±‚**: ç¬¬8ç«  è¿œç¨‹æ§åˆ¶

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `CALL_TYPE_LOOP` | 1 | å‘¼å«å¾ªç¯ |
| `CALL_TYPE_ARRIVE` | 2 | å‘¼å«åˆ°è¾¾ |
| `CALL_TYPE_RECOVERY` | 3 | å‘¼å«å›æ”¶ |

**æ ¸å¿ƒæ–¹æ³•**:
```java
// å¯ç”¨æ§åˆ¶
void setRemoteCallEnabled(boolean enabled, IResultCallback<Void> callback);
void isRemoteCallEnabled(IResultCallback<Boolean> callback);

// è¿œç¨‹å‘¼å«æ“ä½œ
void handleRemoteCall(int targetPointId, int callType, IResultCallback<Void> callback);
void cancelRemoteCall(IResultCallback<Void> callback);
void isRemoteCallActive(IResultCallback<Boolean> callback);

// åœç•™è®¾ç½®
void setArrivalStayDurationEnabled(boolean enabled, IResultCallback<Void> callback);
void setArrivalStayDuration(int durationSeconds, IResultCallback<Void> callback);
void getArrivalStayDuration(IResultCallback<Integer> callback);

// å›è°ƒæ³¨å†Œ
void registerCallback(IRemoteCallCallback callback);
void unregisterCallback(IRemoteCallCallback callback);
```

### 2.4 IRobotStateService - æœºå™¨äººçŠ¶æ€æœåŠ¡

**æ–‡ä»¶**: `service/IRobotStateService.java`  
**å¯¹åº”éœ€æ±‚**: æœºå™¨äººçŠ¶æ€ç›‘æ§

| å¸¸é‡ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `WORK_MODE_STANDBY` | 0 | å¾…æœºæ¨¡å¼ |
| `WORK_MODE_NAVIGATION` | 1 | å¯¼èˆªæ¨¡å¼ |
| `WORK_MODE_CHARGING` | 2 | å……ç”µæ¨¡å¼ |
| `WORK_MODE_MANUAL` | 3 | æ‰‹åŠ¨æ¨¡å¼ |

**æ ¸å¿ƒæ–¹æ³•** âœ… å«è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢:
```java
// åŸºç¡€çŠ¶æ€æŸ¥è¯¢
void getRobotState(IResultCallback<RobotState> callback);
void getBatteryLevel(IResultCallback<Integer> callback);
void getCurrentLocation(IResultCallback<NavigationNode> callback);
void isScramPressed(IResultCallback<Boolean> callback);
void getMotorStatus(IResultCallback<MotorInfo> callback);

// è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢ âœ… å¯¹é½SDK RuntimeInfo
void getTotalOdometer(IResultCallback<Double> callback);
void getRobotIp(IResultCallback<String> callback);
void getRobotArmInfo(IResultCallback<String> callback);
void getRobotStm32Info(IResultCallback<String> callback);
void getDestinationList(IResultCallback<String> callback);
void getRobotProperties(IResultCallback<String> callback);

// æ§åˆ¶æ–¹æ³•
void setWorkMode(int mode, IResultCallback<Void> callback);
void setEmergencyEnabled(boolean enabled, IResultCallback<Void> callback);
void setMotorEnabled(boolean enabled, IResultCallback<Void> callback);
void syncParams(IResultCallback<Void> callback);
void reboot(IResultCallback<Void> callback);
void performLocalization(IResultCallback<Void> callback);

// å›è°ƒæ³¨å†Œ
void registerCallback(IStateCallback callback);
void unregisterCallback(IStateCallback callback);
```

### 2.5 å…¶ä»–æœåŠ¡æ¥å£

| æ¥å£ | æ–‡ä»¶ | å¯¹åº”éœ€æ±‚ |
|------|------|----------|
| `IDoorService` | `service/IDoorService.java` | ç¬¬6ç«  èˆ±é—¨è®¾ç½® |
| `ISecurityService` | `service/ISecurityService.java` | ç¬¬1ç«  ä»»åŠ¡å®‰å…¨ä¸æƒé™æ§åˆ¶ |
| `ITimingService` | `service/ITimingService.java` | ç¬¬2ç«  ä½œä¸šè¿‡ç¨‹è®¡é‡ |
| `IAudioService` | `service/IAudioService.java` | ç¬¬10ç«  å£°éŸ³è®¾ç½® |

---

## ä¸‰ã€å›è°ƒæ¥å£ä¸é”™è¯¯ç 

### 3.1 å›è°ƒæ¥å£

| æ¥å£ | ç”¨é€” | æ–¹æ³• |
|------|------|------|
| `IResultCallback<T>` | é€šç”¨å¼‚æ­¥ç»“æœ | `onSuccess(T)`, `onError(ApiError)` |
| `IProgressCallback<T>` | å¸¦è¿›åº¦å›è°ƒ | ç»§æ‰¿`IResultCallback` + `onProgress(int)` |
| `INavigationCallback` | å¯¼èˆªçŠ¶æ€ | `onStateChanged`, `onRouteNode`, `onRoutePrepared`, `onDistanceChanged`, `onNavigationError` |
| `IDoorCallback` | èˆ±é—¨çŠ¶æ€ | `onDoorStateChanged`, `onDoorTypeChanged`, `onDoorTypeSettingResult`, `onDoorError` |
| `IChargerCallback` | å……ç”µçŠ¶æ€ | `onChargerInfoChanged`, `onChargerStatusChanged`, `onChargerError` |
| `IStateCallback` | æœºå™¨äººçŠ¶æ€ | `onStateChanged`, `onLocationChanged`, `onBatteryLevelChanged`, `onScramButtonPressed` |

### 3.2 é”™è¯¯ç ä½“ç³»

```
é”™è¯¯ç åˆ†ç±»:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚é”™è¯¯ç  (ErrorCode)                      â”‚
â”‚                       èŒƒå›´: -1 ~ -999                            â”‚
â”‚  -100~-199: ç½‘ç»œé”™è¯¯     -200~-299: è®¾å¤‡é”™è¯¯                      â”‚
â”‚  -300~-399: è¶…æ—¶é”™è¯¯     -400~-499: éªŒè¯é”™è¯¯                      â”‚
â”‚  -500~-599: æƒé™é”™è¯¯     -600~-699: ä»»åŠ¡é”™è¯¯                      â”‚
â”‚  -700~-799: ç‚¹ä½é”™è¯¯     -800~-899: èˆ±é—¨é”™è¯¯                      â”‚
â”‚  -900~-999: å®‰å…¨é”™è¯¯                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    SDKé”™è¯¯ç  (SdkErrorCode)                      â”‚
â”‚                      èŒƒå›´: 200000+                               â”‚
â”‚  200500~200503: èˆ±é—¨é”™è¯¯        203000~203032: åˆå§‹åŒ–/æˆæƒé”™è¯¯     â”‚
â”‚  203100~203102: ä¸²å£é”™è¯¯        203150~203173: CoAPé”™è¯¯           â”‚
â”‚  203300~203317: å……ç”µé”™è¯¯        203400~203411: å¯¼èˆªé”™è¯¯           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å……ç”µäº‹ä»¶ç  (SdkErrorCode)                      â”‚
â”‚                      èŒƒå›´: 40001~40020                           â”‚
â”‚  40001: åˆ°è¾¾å……ç”µæ¡©     40011: æ­£åœ¨å……ç”µ     40020: é€€å‡ºå……ç”µ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä½¿ç”¨ç¤ºä¾‹**:
```java
// åˆ¤æ–­é”™è¯¯ç±»å‹
if (ErrorCode.isAppError(code)) {
    // åº”ç”¨å±‚é”™è¯¯ï¼Œä½¿ç”¨ ErrorCode.getErrorMessage(code)
} else if (ErrorCode.isSdkError(code)) {
    // SDKé”™è¯¯ï¼Œä½¿ç”¨ SdkErrorCode.getErrorDescription(code)
}

// è·å–ä¸­æ–‡é”™è¯¯æè¿°
String msg = ErrorCode.getErrorMessage(code); // ç»Ÿä¸€å…¥å£ï¼Œè‡ªåŠ¨å§”æ‰˜
```

---

## å››ã€æ•°æ®æ¨¡å‹

### 4.1 æ¨¡å‹ç±»æ¸…å•

| æ¨¡å‹ | è¯´æ˜ | Serializable | ç‰¹æ®Šè¯´æ˜ |
|------|------|:------------:|----------|
| `DeliveryTask` | é…é€ä»»åŠ¡ | âœ… | å« `DeliveryType`ã€`DeliveryStatus` æšä¸¾ |
| `DeliveryConfig` | é…é€é…ç½® | âœ… | å« `DeliveryMode` æšä¸¾ï¼ˆå¯¹åº”éœ€æ±‚ä¹¦ç¬¬5ç« ï¼‰ |
| `LoopDeliveryConfig` | å¾ªç¯é…é€é…ç½® | âœ… | ç‹¬ç«‹ç±»ï¼Œæ»¡è¶³ç¬¬7ç«  |
| `PointInfo` | ç‚¹ä½ä¿¡æ¯ | âœ… | å« `PointType` æšä¸¾ |
| `NavigationNode` | å¯¼èˆªèŠ‚ç‚¹ | âœ… | å¯¹åº”SDK `RouteNode` |
| `NavigationState` | å¯¼èˆªçŠ¶æ€å¸¸é‡ | - | å« `isTerminalState()` ç­‰å·¥å…·æ–¹æ³• |
| `ChargerInfo` | å……ç”µä¿¡æ¯ | âœ… | å¯¹åº”SDK `ChargerInfo` |
| `DoorType` | èˆ±é—¨ç±»å‹ | - | æšä¸¾ï¼Œå« `fromTypeId()` è½¬æ¢æ–¹æ³• |
| `RobotState` | æœºå™¨äººçŠ¶æ€ | âœ… | å†…éƒ¨ç±» `LocationInfo` ä¹Ÿå®ç° Serializable |
| `AudioConfig` | éŸ³é¢‘é…ç½® | âœ… | æ»¡è¶³ç¬¬10ç«  |
| `TaskTiming` | è®¡æ—¶ä¿¡æ¯ | âœ… | çº¯æ•°æ®æ¨¡å‹ï¼Œä¸šåŠ¡é€»è¾‘ç§»è‡³ `TimingController` |
| `DeviceInfo` | è®¾å¤‡ä¿¡æ¯ | âœ… | å« `VersionInfo`ã€`EnvInfo` å†…éƒ¨ç±» |
| `MotorInfo` | ç”µæœºä¿¡æ¯ | âœ… | - |

### 4.2 NavigationState å·¥å…·æ–¹æ³•

```java
// åˆ¤æ–­å¯¼èˆªæ˜¯å¦å·²ç»“æŸ
boolean ended = NavigationState.isTerminalState(state);  // DESTINATION/STOPPED/ERROR/END

// åˆ¤æ–­å¯¼èˆªæ˜¯å¦è¿›è¡Œä¸­
boolean running = NavigationState.isActiveState(state);  // RUNNING/BLOCKING

// åˆ¤æ–­æ˜¯å¦å¼‚å¸¸çŠ¶æ€
boolean abnormal = NavigationState.isAbnormalState(state);  // COLLISION/BLOCKED/ERROR
```

### 4.3 TimingController è®¡æ—¶æ§åˆ¶å™¨

```java
// åˆ›å»ºæ§åˆ¶å™¨
TimingController controller = new TimingController("task-001");

// è®¡æ—¶æ“ä½œ
controller.start();
controller.pause();
controller.resume();
controller.stop();

// è·å–å·²ç”¨æ—¶é—´
long elapsed = controller.getCurrentElapsedTime();
String formatted = controller.getFormattedElapsedTime(); // "00:05:32"

// è·å–åº•å±‚æ•°æ®æ¨¡å‹
TaskTiming timing = controller.getTiming();
```

---

## äº”ã€å¼€å‘åˆ†å·¥

### 5.1 Dev Aï¼šæ¶æ„ä¸ç¡¬ä»¶åº•å±‚

| æ¨¡å— | ä»»åŠ¡ | çŠ¶æ€ |
|------|------|------|
| `service/impl/` | å®ç°8ä¸ªæœåŠ¡æ¥å£ | ğŸ”´ å¾…å®ç° |
| `core/` | å®Œå–„SDKå°è£…å±‚ | ğŸŸ¡ éƒ¨åˆ†å®Œæˆ |
| `app/` | SDKåˆå§‹åŒ–ä¸ç”Ÿå‘½å‘¨æœŸ | ğŸ”´ å¾…å®ç° |

**å…·ä½“ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `NavigationServiceImpl`
- [ ] å®ç° `DoorServiceImpl`
- [ ] å®ç° `ChargerServiceImpl`
- [ ] å®ç° `SecurityServiceImpl`
- [ ] å®ç° `TimingServiceImpl`
- [ ] å®ç° `AudioServiceImpl`
- [ ] å®ç° `RobotStateServiceImpl`
- [ ] å®ç° `RemoteCallServiceImpl` âœ… æ–°å¢æ¥å£
- [ ] åˆ›å»º `ServiceManager` ç»Ÿä¸€ç®¡ç†æœåŠ¡å®ä¾‹

### 5.2 Dev Bï¼šä¸šåŠ¡æµç¨‹ä¸UIäº¤äº’

| æ¨¡å— | ä»»åŠ¡ | çŠ¶æ€ |
|------|------|------|
| `manager/` | ä¸šåŠ¡çŠ¶æ€æœº | ğŸ”´ å¾…å®ç° |
| `ui/` | ç•Œé¢å¼€å‘ | ğŸ”´ å¾…å®ç° |
| `base/` | åŸºç¡€ç±» | ğŸ”´ å¾…å®ç° |

**å…·ä½“ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®ç° `BaseActivity` / `BaseFragment`
- [ ] å®ç° `TaskManager` ä»»åŠ¡çŠ¶æ€æœº
- [ ] å®ç° `AuthManager` æƒé™ç®¡ç†
- [ ] å®ç° `StatsManager` ä½œä¸šè®¡é‡
- [ ] å¼€å‘ä¸»ç•Œé¢
- [ ] å¼€å‘é…é€ä»»åŠ¡ç•Œé¢
- [ ] å¼€å‘å¯†ç éªŒè¯ç•Œé¢
- [ ] å¼€å‘è¿œç¨‹å‘¼å«ç•Œé¢ âœ… å¯¹åº”æ–°å¢æ¥å£
- [ ] å¼€å‘è®¾ç½®ç•Œé¢

---

## å…­ã€å¼€å‘è§„èŒƒ

### 6.1 è°ƒç”¨é“¾è·¯

```
UIå±‚ (Activity)
    â†“ è°ƒç”¨
Managerå±‚ (TaskManager)
    â†“ è°ƒç”¨
Serviceæ¥å£å±‚ (INavigationService)
    â†“ å®ç°
Serviceå®ç°å±‚ (NavigationServiceImpl)  â† Dev A å®ç°
    â†“ è°ƒç”¨
Coreå±‚ (SDKå°è£… / TimingController)
    â†“ è°ƒç”¨
Peanut SDK
```

### 6.2 ä»£ç ç¤ºä¾‹

**Dev B è°ƒç”¨å¯¼èˆªæœåŠ¡**:
```java
INavigationService navService = ServiceManager.getNavigationService();

// è®¾ç½®ç›®æ ‡ç‚¹
List<NavigationNode> targets = Arrays.asList(nodeA, nodeB);
navService.setTargets(targets, new IResultCallback<Void>() {
    @Override
    public void onSuccess(Void result) {
        navService.prepare(new IResultCallback<Void>() {
            @Override
            public void onSuccess(Void result) {
                navService.start(null);
            }
            @Override
            public void onError(ApiError error) {
                showError(error);
            }
        });
    }
    @Override
    public void onError(ApiError error) {
        showError(error);
    }
});
```

**Dev B å¤„ç†å¯¼èˆªçŠ¶æ€**:
```java
navService.registerCallback(new INavigationCallback() {
    @Override
    public void onStateChanged(int state, int scheduleStatus) {
        if (NavigationState.isTerminalState(state)) {
            // å¯¼èˆªç»“æŸï¼Œæ›´æ–°UI
        } else if (NavigationState.isAbnormalState(state)) {
            // å¼‚å¸¸çŠ¶æ€ï¼Œæç¤ºç”¨æˆ·
        }
    }
    
    @Override
    public void onDistanceChanged(double distance) {
        updateDistanceUI(distance);
    }
    // ...
});
```

**Dev B ä½¿ç”¨è®¡æ—¶æ§åˆ¶å™¨**:
```java
// é…é€å¼€å§‹æ—¶
TimingController timer = new TimingController(taskId);
timer.start();

// æš‚åœ/æ¢å¤
timer.pause();
timer.resume();

// é…é€ç»“æŸæ—¶
timer.stop();
TaskTiming result = timer.getTiming();
long totalTime = result.getElapsedTime();
```

### 6.3 é”™è¯¯å¤„ç†

```java
void showError(ApiError error) {
    String message = ErrorCode.getErrorMessage(error.getCode());
    Toast.makeText(this, message, Toast.LENGTH_SHORT).show();
    
    // è®°å½•æ—¥å¿—
    Log.e(TAG, "Error: " + error.getCode() + " - " + message, error.getCause());
}
```

---

## ä¸ƒã€åä½œçº¦å®š

### 7.1 æ¥å£å˜æ›´æµç¨‹

1. Dev B æå‡ºæ¥å£éœ€æ±‚
2. Dev A è¯„å®¡å¯è¡Œæ€§
3. Dev A ä¿®æ”¹/æ–°å¢æ¥å£å®šä¹‰
4. æ›´æ–°æœ¬æ‰‹å†Œ
5. åŒæ–¹ç¡®è®¤åå„è‡ªå®ç°

### 7.2 ä»£ç æ ‡æ³¨

```java
// TODO: @DevA éœ€è¦å®ç°SDKè°ƒç”¨
// TODO: @DevB éœ€è¦å®ŒæˆUIç»‘å®š
// FIXME: å¾…ä¿®å¤çš„é—®é¢˜
// @deprecated å»ºè®®ä½¿ç”¨ XXX æ›¿ä»£
```

### 7.3 æ–‡ä»¶å½’å±

| ç›®å½• | ä¸»è¦è´Ÿè´£äºº | åä½œæ–¹å¼ |
|------|------------|----------|
| `callback/` | Dev A | æ¥å£å®šä¹‰ï¼Œå·²å®Œæˆ |
| `service/` | Dev A | æ¥å£å®šä¹‰ï¼Œå·²å®Œæˆ |
| `service/impl/` | Dev A | ç‹¬ç«‹å®ç° |
| `core/` | Dev A | ç‹¬ç«‹å®ç° |
| `model/` | å…±åŒ | æŒ‰éœ€ä¿®æ”¹ |
| `manager/` | Dev B | ç‹¬ç«‹å®ç° |
| `ui/` | Dev B | ç‹¬ç«‹å®ç° |
| `base/` | Dev B | ç‹¬ç«‹å®ç° |

---

## å…«ã€å‚è€ƒèµ„æ–™

- [å¨é«˜æœºå™¨äººæ§åˆ¶ç³»ç»ŸåŠŸèƒ½éœ€æ±‚ä¹¦](./å¨é«˜æœºå™¨äººæ§åˆ¶ç³»ç»ŸåŠŸèƒ½éœ€æ±‚ä¹¦.md)
- [Peanut SDK V1.3.4 å¼€å‘æ–‡æ¡£](./Peanut%20SDKV1.3.4å¼€å‘æ–‡æ¡£.md)

---

## ä¹ã€æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| 3.0 | 2026-01-18 | æ ¹æ®ä»£ç å®¡æŸ¥ç»“æœå…¨é¢æ›´æ–°ï¼šæ–°å¢`IRemoteCallService`ã€`TimingController`ï¼›æ›´æ–°é”™è¯¯ç ä½“ç³»ï¼›è¡¥å……è®¾å¤‡ä¿¡æ¯æŸ¥è¯¢æ–¹æ³• |
| 2.0 | 2026-01-18 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰é¡¹ç›®æ¶æ„å’Œæ¥å£æ¸…å• |
